<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Update Student</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container py-4">
        <h2 class="text-primary mb-4">Update Student</h2>

        <div class="card shadow-sm">
            <div class="card-body">
                <form id="studentForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name:</label>
                        <input type="text" id="name" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email:</label>
                        <input type="email" id="email" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="gender" class="form-label">Gender:</label>
                        <select id="gender" class="form-select" required>
                            <option value="">-- Select --</option>
                            <option value="1">Male</option>
                            <option value="2">Female</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="birthday" class="form-label">Birthday:</label>
                        <input type="date" id="birthday" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="class_id" class="form-label">Class:</label>
                        <select id="class_id" class="form-select" required></select>
                    </div>

                    <button type="submit" class="btn btn-primary">Update Student</button>
                    <a href="/students/list.html" class="btn btn-secondary ms-2">Cancel</a>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const form = document.getElementById("studentForm");
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");

        const classSelect = document.getElementById("class_id");

        async function loadClasses() {
            const res = await fetch("/api/v1/class");
            const result = await res.json();
            if (res.ok) {
                result.data.forEach(c => {
                    const opt = document.createElement("option");
                    opt.value = c.id;
                    opt.textContent = c.name;
                    classSelect.appendChild(opt);
                });
            }
        }
        loadClasses();

        async function loadStudent() {
            if (!id) return;
            const res = await fetch(`/api/v1/student/${id}`);
            const data = await res.json();
            const student = data.data || data.response;
            if (student) {
                document.getElementById("name").value = student.name || "";
                document.getElementById("email").value = student.email || "";
                document.getElementById("gender").value = student.gender || "";
                document.getElementById("birthday").value = student.birthday || "";
                document.getElementById("class_id").value = student.class_id || "";
            }
        }

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const gender = document.getElementById("gender").value;
            const birthday = document.getElementById("birthday").value;
            const class_id = document.getElementById("class_id").value;

            const res = await fetch(`/api/v1/student/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, email, gender, birthday, class_id }),
            });

            if (res.ok) {
                window.location.href = "/list.html";
            }
        });

        loadStudent();
    </script>
</body>

</html>